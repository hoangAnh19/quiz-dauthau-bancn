<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Trắc nghiệm Đúng/Sai — 200 câu</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body{padding:2rem;background:#f7f9fc}
    .question{padding:1rem;border-radius:.5rem;background:#fff;margin-bottom:.75rem;box-shadow:0 1px 3px rgba(0,0,0,.05)}
    .correct{border-left:4px solid #28a745}
    .wrong{border-left:4px solid #dc3545}
    .small-muted{font-size:.85rem;color:#6c757d}
    .sticky-top-controls{z-index:1020}
  </style>
</head>
<body>
<div class="container">
  <div class="row mb-3 sticky-top sticky-top-controls">
    <div class="col-12 d-flex gap-2 align-items-center">
      <h3 class="m-0">Trắc nghiệm Đúng / Sai — 200 câu</h3>
      <div class="ms-auto">
        <button id="btnStart" class="btn btn-primary">Làm bài</button>
        <button id="btnShowAnswers" class="btn btn-outline-secondary">Hiện đáp án</button>
        <button id="btnExport" class="btn btn-outline-success">Tải kết quả (.json)</button>
        <button id="btnReset" class="btn btn-outline-danger">Xoá chọn</button>
      </div>
    </div>
  </div>

  <div id="info" class="mb-2 small-muted">Sửa bộ câu hỏi trong biến <code>QUESTIONS</code> ở đầu file này để thay nội dung hoặc đáp án. Mặc định hệ tạo 200 câu placeholder để bạn dùng nhanh.</div>

  <div id="questionsContainer"></div>

  <div class="d-flex justify-content-between align-items-center mt-3">
    <div class="small-muted">Câu đã trả lời: <span id="answeredCount">0</span> / <span id="totalCount">0</span></div>
    <div>
      <button id="btnSubmit" class="btn btn-success">Nộp bài & Chấm</button>
    </div>
  </div>

  <div id="resultArea" class="mt-3"></div>
</div>

<script>
/*
  HƯỚNG DẪN NHANH:
  - Mở file này (index.html) trong trình soạn thảo, tìm biến QUESTIONS bên dưới và thay nội dung thành mảng câu thực tế của bạn.
    Mỗi phần tử: { text: 'Nội dung câu hỏi', answer: true } với 'answer' là true = Đúng, false = Sai.
  - Lưu file và đẩy lên GitHub repository -> Settings -> Pages để bật GitHub Pages.
*/

// -------------------- Cấu hình câu hỏi --------------------
// Thay mảng QUESTIONS để nhập 200 câu thật. Mẫu: { text: 'Hà Nội là thủ đô Việt Nam?', answer: true }
const QUESTIONS = (function(){
  // Nếu bạn muốn nhanh, hàm dưới tự sinh 200 placeholder.
  const arr = [];
  for(let i=1;i<=200;i++){
    arr.push({ text: `Câu ${i}: (viết câu hỏi vào đây)`, answer: Math.random() < 0.5 }); // default: random đáp án
  }
  return arr;
})();
// -----------------------------------------------------------

const totalCountEl = document.getElementById('totalCount');
const answeredCountEl = document.getElementById('answeredCount');
const questionsContainer = document.getElementById('questionsContainer');
const btnSubmit = document.getElementById('btnSubmit');
const btnStart = document.getElementById('btnStart');
const btnShowAnswers = document.getElementById('btnShowAnswers');
const btnReset = document.getElementById('btnReset');
const btnExport = document.getElementById('btnExport');
const resultArea = document.getElementById('resultArea');

let userAnswers = Array(QUESTIONS.length).fill(null);
totalCountEl.textContent = QUESTIONS.length;

function renderQuestions(){
  questionsContainer.innerHTML = '';
  QUESTIONS.forEach((q, idx) => {
    const el = document.createElement('div');
    el.className = 'question';
    el.id = `q-${idx}`;
    el.innerHTML = `
      <div class="d-flex justify-content-between align-items-start">
        <div>
          <strong>${idx+1}.</strong> <span class="ms-2">${escapeHtml(q.text)}</span>
        </div>
        <div class="small-muted">Câu #${idx+1}</div>
      </div>
      <div class="mt-2 d-flex gap-3">
        <div class="form-check">
          <input class="form-check-input" type="radio" name="ans-${idx}" id="ans-${idx}-true" value="true">
          <label class="form-check-label" for="ans-${idx}-true">Đúng</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="radio" name="ans-${idx}" id="ans-${idx}-false" value="false">
          <label class="form-check-label" for="ans-${idx}-false">Sai</label>
        </div>
      </div>
    `;
    questionsContainer.appendChild(el);

    // attach listeners
    const radios = el.querySelectorAll(`input[name='ans-${idx}']`);
    radios.forEach(r => r.addEventListener('change', ()=>{
      userAnswers[idx] = (r.value === 'true');
      updateAnsweredCount();
    }));
  });
}

function updateAnsweredCount(){
  const answered = userAnswers.filter(x => x !== null).length;
  answeredCountEl.textContent = answered;
}

function grade(){
  let correct = 0;
  const details = [];
  QUESTIONS.forEach((q,idx)=>{
    const ua = userAnswers[idx];
    const isCorrect = (ua === q.answer);
    details.push({ index: idx+1, question: q.text, correctAnswer: q.answer, userAnswer: ua, isCorrect });
    if(isCorrect) correct++;

    const el = document.getElementById(`q-${idx}`);
    el.classList.remove('correct','wrong');
    if(ua === null){
      // unanswered
    } else if(isCorrect){
      el.classList.add('correct');
    } else {
      el.classList.add('wrong');
    }
  });
  return { correct, total: QUESTIONS.length, details };
}

btnSubmit.addEventListener('click', ()=>{
  const res = grade();
  resultArea.innerHTML = `
    <div class="alert alert-primary">Bạn được <strong>${res.correct}</strong> / ${res.total} điểm. (<strong>${Math.round(res.correct/res.total*100)}%</strong>)</div>
    <div class="d-flex gap-2 mb-2">
      <button id="btnRevealWrong" class="btn btn-outline-secondary btn-sm">Hiển thị câu sai</button>
      <button id="btnRevealAll" class="btn btn-outline-secondary btn-sm">Hiển thị đáp án tất cả</button>
    </div>
  `;

  document.getElementById('btnRevealWrong').addEventListener('click', ()=>{
    revealWrong(res.details);
  });
  document.getElementById('btnRevealAll').addEventListener('click', ()=>{
    revealAll(res.details);
  });
});

btnStart.addEventListener('click', ()=>{
  // scroll to top of questions
  window.scrollTo({top: questionsContainer.offsetTop, behavior:'smooth'});
});

btnShowAnswers.addEventListener('click', ()=>{
  revealAll(QUESTIONS.map((q,idx)=>({ index: idx+1, question: q.text, correctAnswer: q.answer, userAnswer: userAnswers[idx], isCorrect: userAnswers[idx] === q.answer })));
});

btnReset.addEventListener('click', ()=>{
  if(!confirm('Xoá các lựa chọn hiện tại?')) return;
  userAnswers = Array(QUESTIONS.length).fill(null);
  const inputs = document.querySelectorAll("input[type=radio]");
  inputs.forEach(i=>i.checked = false);
  updateAnsweredCount();
  // remove classes
  QUESTIONS.forEach((q,idx)=>{
    const el = document.getElementById(`q-${idx}`);
    el.classList.remove('correct','wrong');
  });
  resultArea.innerHTML = '';
});

btnExport.addEventListener('click', ()=>{
  const res = grade();
  const out = { timestamp: new Date().toISOString(), score: res.correct, total: res.total, percent: Math.round(res.correct/res.total*100), details: res.details };
  const blob = new Blob([JSON.stringify(out, null, 2)], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'quiz-results.json'; a.click();
  URL.revokeObjectURL(url);
});

function revealWrong(details){
  details.forEach(d=>{
    if(!d.isCorrect){
      const el = document.getElementById(`q-${d.index-1}`);
      // show correct answer
      const hint = el.querySelector('.hint-correct');
      if(!hint){
        const span = document.createElement('div');
        span.className = 'mt-2 small-muted hint-correct';
        span.textContent = 'Đáp án đúng: ' + (d.correctAnswer ? 'Đúng' : 'Sai');
        el.appendChild(span);
      }
    }
  });
}

function revealAll(details){
  details.forEach(d=>{
    const el = document.getElementById(`q-${d.index-1}`);
    const hint = el.querySelector('.hint-correct');
    if(!hint){
      const span = document.createElement('div');
      span.className = 'mt-2 small-muted hint-correct';
      span.textContent = 'Đáp án đúng: ' + (d.correctAnswer ? 'Đúng' : 'Sai');
      el.appendChild(span);
    }
  });
}

function escapeHtml(str){
  return str.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
}

// init
renderQuestions();
updateAnsweredCount();

</script>
</body>
</html>
